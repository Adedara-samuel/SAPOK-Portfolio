<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Firebase Connection Test</h1>

    <div id="firebase-status" class="test-section">
        <h3>Firebase Status: <span id="status">Testing...</span></h3>
    </div>

    <div class="test-section">
        <h3>Test Appointment Booking</h3>
        <button onclick="testBooking()">Test Booking</button>
        <div id="booking-result"></div>
    </div>

    <div class="test-section">
        <h3>Test Availability Check</h3>
        <button onclick="testAvailability()">Check Availability</button>
        <div id="availability-result"></div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCgZSVkGJJKrFy_myaeWi1KmEAhocii6RY",
            authDomain: "single-bindery-470709-u8.firebaseapp.com",
            projectId: "single-bindery-470709-u8",
            storageBucket: "single-bindery-470709-u8.firebasestorage.app",
            messagingSenderId: "803704604709",
            appId: "1:803704604709:web:6019e1f8b4a27dcdfd57cc",
            measurementId: "G-NW91L49D4L"
        };

        let db;

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            document.getElementById('status').textContent = 'Connected ✅';
            document.getElementById('firebase-status').classList.add('success');
        } catch (error) {
            document.getElementById('status').textContent = 'Failed ❌: ' + error.message;
            document.getElementById('firebase-status').classList.add('error');
        }

        async function testBooking() {
            const resultDiv = document.getElementById('booking-result');
            resultDiv.innerHTML = 'Testing booking...';

            try {
                const testData = {
                    name: 'Test User',
                    email: 'test@example.com',
                    phone: '123-456-7890',
                    service: 'web-development',
                    date: '2025-12-01',
                    time: '10:00',
                    message: 'Test booking',
                    status: 'pending',
                    createdAt: new Date()
                };

                await db.collection('appointments').add(testData);
                resultDiv.innerHTML = '<span style="color: green;">✅ Booking successful!</span>';
                resultDiv.className = 'success';
            } catch (error) {
                resultDiv.innerHTML = '<span style="color: red;">❌ Booking failed: ' + error.message + '</span>';
                resultDiv.className = 'error';
            }
        }

        async function testAvailability() {
            const resultDiv = document.getElementById('availability-result');
            resultDiv.innerHTML = 'Checking availability...';

            try {
                const testDate = '2025-12-01';
                const appointments = await db.collection('appointments')
                    .where('date', '==', testDate)
                    .where('status', 'in', ['pending', 'confirmed'])
                    .get();

                const bookedSlots = appointments.docs.map(doc => doc.data().time);
                const allSlots = ['09:00', '10:00', '11:00', '14:00', '15:00', '16:00', '17:00'];
                const availableSlots = allSlots.filter(slot => !bookedSlots.includes(slot));

                resultDiv.innerHTML = `
                    <strong>Available slots for ${testDate}:</strong><br>
                    ${availableSlots.join(', ')}<br>
                    <strong>Booked slots:</strong> ${bookedSlots.join(', ') || 'None'}
                `;
                resultDiv.className = 'success';
            } catch (error) {
                resultDiv.innerHTML = '<span style="color: red;">❌ Availability check failed: ' + error.message + '</span>';
                resultDiv.className = 'error';
            }
        }
    </script>
</body>
</html>